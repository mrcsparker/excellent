/*
Copyright 2014 Chris Parker. Licensed under the Apache 2.0 License.
http://www.apache.org/licenses/LICENSE-2.0.html
*/

!function(){"use strict";var jStat=jstat;FormulaParser=function(){function a(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var b={parse:function(b,c){function d(a){var b={};for(var c in a)b[c]=a[c];return b}function e(a,c){for(var d=a.offset+c,e=a.offset;d>e;e++){var f=b.charAt(e);"\n"===f?(a.seenCR||a.line++,a.column=1,a.seenCR=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(a.line++,a.column=1,a.seenCR=!0):(a.column++,a.seenCR=!1)}a.offset+=c}function f(a){E.offset<G.offset||(E.offset>G.offset&&(G=d(E),H=[]),H.push(a))}function g(){var a;return 42===b.charCodeAt(E.offset)?(a="*",e(E,1)):(a=null,0===F&&f('"*"')),null===a&&(47===b.charCodeAt(E.offset)?(a="/",e(E,1)):(a=null,0===F&&f('"/"')),null===a&&(43===b.charCodeAt(E.offset)?(a="+",e(E,1)):(a=null,0===F&&f('"+"')),null===a&&(45===b.charCodeAt(E.offset)?(a="-",e(E,1)):(a=null,0===F&&f('"-"')),null===a&&(94===b.charCodeAt(E.offset)?(a="^",e(E,1)):(a=null,0===F&&f('"^"')),null===a&&(61===b.charCodeAt(E.offset)?(a="=",e(E,1)):(a=null,0===F&&f('"="')),null===a&&(38===b.charCodeAt(E.offset)?(a="&",e(E,1)):(a=null,0===F&&f('"&"')),null===a&&(60===b.charCodeAt(E.offset)?(a="<",e(E,1)):(a=null,0===F&&f('"<"')),null===a&&(62===b.charCodeAt(E.offset)?(a=">",e(E,1)):(a=null,0===F&&f('">"')))))))))),a}function h(){var a,b,c,e,f,h,j,k,l;if(j=d(E),k=d(E),a=i(),null!==a){for(b=[],l=d(E),c=A(),null!==c?(e=g(),null!==e?(f=A(),null!==f?(h=i(),null!==h?c=[c,e,f,h]:(c=null,E=d(l))):(c=null,E=d(l))):(c=null,E=d(l))):(c=null,E=d(l));null!==c;)b.push(c),l=d(E),c=A(),null!==c?(e=g(),null!==e?(f=A(),null!==f?(h=i(),null!==h?c=[c,e,f,h]:(c=null,E=d(l))):(c=null,E=d(l))):(c=null,E=d(l))):(c=null,E=d(l));null!==b?a=[a,b]:(a=null,E=d(k))}else a=null,E=d(k);return null!==a&&(a=function(a,b,c,d,e){for(var f,g=[d],h=0;h<e.length;h+=1)f=e[h][1],f=f.replace("=","=="),f=f.replace("&",'+""+'),g.push(f),g.push(e[h][3]);return g.join("")}(j.offset,j.line,j.column,a[0],a[1])),null===a&&(E=d(j)),a}function i(){var a;return a=j(),null===a&&(a=k(),null===a&&(a=n(),null===a&&(a=m(),null===a&&(a=q(),null===a&&(a=l()))))),a}function j(){var a,c,g,i,j;return i=d(E),j=d(E),40===b.charCodeAt(E.offset)?(a="(",e(E,1)):(a=null,0===F&&f('"("')),null!==a?(c=h(),null!==c?(41===b.charCodeAt(E.offset)?(g=")",e(E,1)):(g=null,0===F&&f('")"')),null!==g?a=[a,c,g]:(a=null,E=d(j))):(a=null,E=d(j))):(a=null,E=d(j)),null!==a&&(a=function(a,b,c,d){return"("+d+")"}(i.offset,i.line,i.column,a[1])),null===a&&(E=d(i)),a}function k(){var a,c,g,h,i,j,k,l,m;if(k=d(E),l=d(E),/^[0-9]/.test(b.charAt(E.offset))?(c=b.charAt(E.offset),e(E,1)):(c=null,0===F&&f("[0-9]")),null!==c)for(a=[];null!==c;)a.push(c),/^[0-9]/.test(b.charAt(E.offset))?(c=b.charAt(E.offset),e(E,1)):(c=null,0===F&&f("[0-9]"));else a=null;if(null!==a?(37===b.charCodeAt(E.offset)?(c="%",e(E,1)):(c=null,0===F&&f('"%"')),null!==c?a=[a,c]:(a=null,E=d(l))):(a=null,E=d(l)),null!==a&&(a=function(a,b,c,d){return console.log(parseFloat(d.join("").replace(/,/g,"").replace(/%/g,""),10)),parseFloat(d.join("").replace(/,/g,"").replace(/%/g,""),10)/100}(k.offset,k.line,k.column,a)),null===a&&(E=d(k)),null===a){if(k=d(E),l=d(E),45===b.charCodeAt(E.offset)?(a="-",e(E,1)):(a=null,0===F&&f('"-"')),a=null!==a?a:"",null!==a){if(/^[0-9]/.test(b.charAt(E.offset))?(g=b.charAt(E.offset),e(E,1)):(g=null,0===F&&f("[0-9]")),null!==g)for(c=[];null!==g;)c.push(g),/^[0-9]/.test(b.charAt(E.offset))?(g=b.charAt(E.offset),e(E,1)):(g=null,0===F&&f("[0-9]"));else c=null;if(null!==c){if(m=d(E),46===b.charCodeAt(E.offset)?(g=".",e(E,1)):(g=null,0===F&&f('"."')),null!==g){if(/^[0-9]/.test(b.charAt(E.offset))?(i=b.charAt(E.offset),e(E,1)):(i=null,0===F&&f("[0-9]")),null!==i)for(h=[];null!==i;)h.push(i),/^[0-9]/.test(b.charAt(E.offset))?(i=b.charAt(E.offset),e(E,1)):(i=null,0===F&&f("[0-9]"));else h=null;null!==h?g=[g,h]:(g=null,E=d(m))}else g=null,E=d(m);if(g=null!==g?g:"",null!==g){if(m=d(E),101===b.charCodeAt(E.offset)?(h="e",e(E,1)):(h=null,0===F&&f('"e"')),null!==h){if(/^[0-9]/.test(b.charAt(E.offset))?(j=b.charAt(E.offset),e(E,1)):(j=null,0===F&&f("[0-9]")),null!==j)for(i=[];null!==j;)i.push(j),/^[0-9]/.test(b.charAt(E.offset))?(j=b.charAt(E.offset),e(E,1)):(j=null,0===F&&f("[0-9]"));else i=null;null!==i?h=[h,i]:(h=null,E=d(m))}else h=null,E=d(m);h=null!==h?h:"",null!==h?a=[a,c,g,h]:(a=null,E=d(l))}else a=null,E=d(l)}else a=null,E=d(l)}else a=null,E=d(l);null!==a&&(a=function(a,b,c,d){return parseFloat(d.join("").replace(/,/g,""),10)}(k.offset,k.line,k.column,a)),null===a&&(E=d(k))}return a}function l(){var a,c,g,h,i;if(h=d(E),i=d(E),34===b.charCodeAt(E.offset)?(a='"',e(E,1)):(a=null,0===F&&f('"\\""')),null!==a){if(/^[^'"\n]/.test(b.charAt(E.offset))?(g=b.charAt(E.offset),e(E,1)):(g=null,0===F&&f("[^'\"\\n]")),null!==g)for(c=[];null!==g;)c.push(g),/^[^'"\n]/.test(b.charAt(E.offset))?(g=b.charAt(E.offset),e(E,1)):(g=null,0===F&&f("[^'\"\\n]"));else c=null;null!==c?(34===b.charCodeAt(E.offset)?(g='"',e(E,1)):(g=null,0===F&&f('"\\""')),null!==g?a=[a,c,g]:(a=null,E=d(i))):(a=null,E=d(i))}else a=null,E=d(i);if(null!==a&&(a=function(a,b,c,d){return'"'+d.join("")+'"'}(h.offset,h.line,h.column,a[1])),null===a&&(E=d(h)),null===a){if(h=d(E),i=d(E),39===b.charCodeAt(E.offset)?(a="'",e(E,1)):(a=null,0===F&&f('"\'"')),null!==a){if(/^[^'"\n]/.test(b.charAt(E.offset))?(g=b.charAt(E.offset),e(E,1)):(g=null,0===F&&f("[^'\"\\n]")),null!==g)for(c=[];null!==g;)c.push(g),/^[^'"\n]/.test(b.charAt(E.offset))?(g=b.charAt(E.offset),e(E,1)):(g=null,0===F&&f("[^'\"\\n]"));else c=null;null!==c?(39===b.charCodeAt(E.offset)?(g="'",e(E,1)):(g=null,0===F&&f('"\'"')),null!==g?a=[a,c,g]:(a=null,E=d(i))):(a=null,E=d(i))}else a=null,E=d(i);null!==a&&(a=function(a,b,c,d){return'"'+d.join("")+'"'}(h.offset,h.line,h.column,a[1])),null===a&&(E=d(h)),null===a&&(h=d(E),"''"===b.substr(E.offset,2)?(a="''",e(E,2)):(a=null,0===F&&f("\"''\"")),null!==a&&(a=function(){return'""'}(h.offset,h.line,h.column)),null===a&&(E=d(h)),null===a&&(h=d(E),'""'===b.substr(E.offset,2)?(a='""',e(E,2)):(a=null,0===F&&f('"\\"\\""')),null!==a&&(a=function(){return'""'}(h.offset,h.line,h.column)),null===a&&(E=d(h))))}return a}function m(){var a,b,c,e,f,g;return f=d(E),g=d(E),a=A(),null!==a?(b=s(),null!==b?(c=A(),null!==c?(e=o(),null!==e?a=[a,b,c,e]:(a=null,E=d(g))):(a=null,E=d(g))):(a=null,E=d(g))):(a=null,E=d(g)),null!==a&&(a=function(a,b,c,d,e){return"Formula."+d+e}(f.offset,f.line,f.column,a[1],a[3])),null===a&&(E=d(f)),a}function n(){var a,c,g,h,i,j,k;return j=d(E),k=d(E),a=s(),null!==a?(c=A(),null!==c?(58===b.charCodeAt(E.offset)?(g=":",e(E,1)):(g=null,0===F&&f('":"')),null!==g?(h=A(),null!==h?(i=s(),null!==i?a=[a,c,g,h,i]:(a=null,E=d(k))):(a=null,E=d(k))):(a=null,E=d(k))):(a=null,E=d(k))):(a=null,E=d(k)),null!==a&&(a=function(a,b,c,d,e){for(var f=parseInt(d.match(/[0-9]+/gi)[0]),g=d.match(/[A-Z]+/gi)[0],h=I(g),i=parseInt(e.match(/[0-9]+/gi)[0]),j=e.match(/[A-Z]+/gi)[0],k=(I(j),i-f+1),l=I(j)-I(g)+1,m=0,n=1,o="",p=[];k>=n;n+=1){for(;l>m;m+=1)o=J(h+m)+""+(f+n-1),p.push("this."+o);m=0}return"["+p.join(",")+"]"}(j.offset,j.line,j.column,a[0],a[4])),null===a&&(E=d(j)),a}function o(){var a,c,g,h,i,j,k;return j=d(E),k=d(E),40===b.charCodeAt(E.offset)?(a="(",e(E,1)):(a=null,0===F&&f('"("')),null!==a?(c=A(),null!==c?(g=p(),g=null!==g?g:"",null!==g?(h=A(),null!==h?(41===b.charCodeAt(E.offset)?(i=")",e(E,1)):(i=null,0===F&&f('")"')),null!==i?a=[a,c,g,h,i]:(a=null,E=d(k))):(a=null,E=d(k))):(a=null,E=d(k))):(a=null,E=d(k))):(a=null,E=d(k)),null!==a&&(a=function(a,b,c,d){return d.length>0?"("+d.join(",")+")":"()"}(j.offset,j.line,j.column,a[2])),null===a&&(E=d(j)),a}function p(){var a,c,g,i,j,k,l,m,n;if(l=d(E),m=d(E),a=h(),null!==a){for(c=[],n=d(E),g=A(),null!==g?(44===b.charCodeAt(E.offset)?(i=",",e(E,1)):(i=null,0===F&&f('","')),null!==i?(j=A(),null!==j?(k=h(),null!==k?g=[g,i,j,k]:(g=null,E=d(n))):(g=null,E=d(n))):(g=null,E=d(n))):(g=null,E=d(n));null!==g;)c.push(g),n=d(E),g=A(),null!==g?(44===b.charCodeAt(E.offset)?(i=",",e(E,1)):(i=null,0===F&&f('","')),null!==i?(j=A(),null!==j?(k=h(),null!==k?g=[g,i,j,k]:(g=null,E=d(n))):(g=null,E=d(n))):(g=null,E=d(n))):(g=null,E=d(n));null!==c?a=[a,c]:(a=null,E=d(m))}else a=null,E=d(m);return null!==a&&(a=function(a,b,c,d,e){for(var f=[d],g=0;g<e.length;g++)f.push(e[g][3]);return f}(l.offset,l.line,l.column,a[0],a[1])),null===a&&(E=d(l)),a}function q(){var a,c,g,h,i,j;return i=d(E),j=d(E),39===b.charCodeAt(E.offset)?(a="'",e(E,1)):(a=null,0===F&&f('"\'"')),null!==a?(c=w(),null!==c?("'!"===b.substr(E.offset,2)?(g="'!",e(E,2)):(g=null,0===F&&f('"\'!"')),null!==g?(h=r(),null!==h?a=[a,c,g,h]:(a=null,E=d(j))):(a=null,E=d(j))):(a=null,E=d(j))):(a=null,E=d(j)),null!==a&&(a=function(a,b,c,d,e){return"self.workbook['"+d.join("")+"']."+e}(i.offset,i.line,i.column,a[1],a[3])),null===a&&(E=d(i)),null===a&&(i=d(E),j=d(E),a=s(),null!==a?(33===b.charCodeAt(E.offset)?(c="!",e(E,1)):(c=null,0===F&&f('"!"')),null!==c?(g=r(),null!==g?a=[a,c,g]:(a=null,E=d(j))):(a=null,E=d(j))):(a=null,E=d(j)),null!==a&&(a=function(a,b,c,d,e){return"self.workbook['"+d+"']."+e}(i.offset,i.line,i.column,a[0],a[2])),null===a&&(E=d(i)),null===a&&(i=d(E),j=d(E),45===b.charCodeAt(E.offset)?(a="-",e(E,1)):(a=null,0===F&&f('"-"')),null!==a?(c=r(),null!==c?a=[a,c]:(a=null,E=d(j))):(a=null,E=d(j)),null!==a&&(a=function(a,b,c,d){return"-this."+d}(i.offset,i.line,i.column,a[1])),null===a&&(E=d(i)),null===a&&(i=d(E),a=r(),null!==a&&(a=function(a,b,c,d){return"this."+d}(i.offset,i.line,i.column,a)),null===a&&(E=d(i))))),a}function r(){var a,b;return b=d(E),a=s(),null!==a&&(a=function(a,b,c,d){return d}(b.offset,b.line,b.column,a)),null===a&&(E=d(b)),a}function s(){var a,b;return b=d(E),a=t(),null!==a&&(a=function(a,b,c,d){return d}(b.offset,b.line,b.column,a)),null===a&&(E=d(b)),a}function t(){var a,b,c,e,f;if(e=d(E),f=d(E),a=u(),null!==a){for(b=[],c=v();null!==c;)b.push(c),c=v();null!==b?a=[a,b]:(a=null,E=d(f))}else a=null,E=d(f);return null!==a&&(a=function(a,b,c,d,e){return d+e.join("")}(e.offset,e.line,e.column,a[0],a[1])),null===a&&(E=d(e)),a}function u(){var a;return a=x(),null===a&&(36===b.charCodeAt(E.offset)?(a="$",e(E,1)):(a=null,0===F&&f('"$"')),null===a&&(95===b.charCodeAt(E.offset)?(a="_",e(E,1)):(a=null,0===F&&f('"_"')))),a}function v(){var a;return a=u(),null===a&&(a=z()),a}function w(){var a,c;for(a=[],38===b.charCodeAt(E.offset)?(c="&",e(E,1)):(c=null,0===F&&f('"&"')),null===c&&(45===b.charCodeAt(E.offset)?(c="-",e(E,1)):(c=null,0===F&&f('"-"')),null===c&&(95===b.charCodeAt(E.offset)?(c="_",e(E,1)):(c=null,0===F&&f('"_"')),null===c&&(32===b.charCodeAt(E.offset)?(c=" ",e(E,1)):(c=null,0===F&&f('" "')),null===c&&(/^[a-z]/.test(b.charAt(E.offset))?(c=b.charAt(E.offset),e(E,1)):(c=null,0===F&&f("[a-z]")),null===c&&(/^[A-Z]/.test(b.charAt(E.offset))?(c=b.charAt(E.offset),e(E,1)):(c=null,0===F&&f("[A-Z]")))))));null!==c;)a.push(c),38===b.charCodeAt(E.offset)?(c="&",e(E,1)):(c=null,0===F&&f('"&"')),null===c&&(45===b.charCodeAt(E.offset)?(c="-",e(E,1)):(c=null,0===F&&f('"-"')),null===c&&(95===b.charCodeAt(E.offset)?(c="_",e(E,1)):(c=null,0===F&&f('"_"')),null===c&&(32===b.charCodeAt(E.offset)?(c=" ",e(E,1)):(c=null,0===F&&f('" "')),null===c&&(/^[a-z]/.test(b.charAt(E.offset))?(c=b.charAt(E.offset),e(E,1)):(c=null,0===F&&f("[a-z]")),null===c&&(/^[A-Z]/.test(b.charAt(E.offset))?(c=b.charAt(E.offset),e(E,1)):(c=null,0===F&&f("[A-Z]")))))));return a}function x(){var a;return/^[a-zA-Z]/.test(b.charAt(E.offset))?(a=b.charAt(E.offset),e(E,1)):(a=null,0===F&&f("[a-zA-Z]")),a}function y(){var a,b;for(a=[],b=z();null!==b;)a.push(b),b=z();return a}function z(){var a;return/^[0-9]/.test(b.charAt(E.offset))?(a=b.charAt(E.offset),e(E,1)):(a=null,0===F&&f("[0-9]")),a}function A(){var a,b;for(a=[],b=B();null!==b;)a.push(b),b=B();return a}function B(){var a;return F++,/^[ \t\r\n]/.test(b.charAt(E.offset))?(a=b.charAt(E.offset),e(E,1)):(a=null,0===F&&f("[ \\t\\r\\n]")),F--,0===F&&null===a&&f("whitespace"),a}function C(a){a.sort();for(var b=null,c=[],d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);return c}var D={ArithmeticOperator:g,ArithmeticExpression:h,Atom:i,ParenExpression:j,Number:k,String:l,FunctionCall:m,Range:n,Arguments:o,ArgumentList:p,Variable:q,IdentifierVariable:r,Identifier:s,IdentifierName:t,IdentifierStart:u,IdentifierPart:v,AlphaNumeric:w,Alpha:x,Digits:y,Digit:z,__:A,WhiteSpace:B};if(void 0!==c){if(void 0===D[c])throw new Error("Invalid rule name: "+a(c)+".")}else c="ArithmeticExpression";var E={offset:0,line:1,column:1,seenCR:!1},F=0,G={offset:0,line:1,column:1,seenCR:!1},H=[],I=function(a){a=a.toUpperCase();var b,c=0,d=0;if(null!==a&&"undefined"!=typeof a&&a.length>0)for(b=0;b<a.length;b+=1)c=a.charCodeAt(a.length-b-1)-"A".charCodeAt(0),d+=Math.pow(26,b)*(c+1);return d-1},J=function(a){a=Math.abs(a);var b,c="",d=!1;do b=a%26,d&&25>a&&(b-=1),c=String.fromCharCode(b+"A".charCodeAt(0))+c,a=Math.floor((a-b)/26),d=!0;while(a>0);return c},K=D[c]();if(null===K||E.offset!==b.length){var L=Math.max(E.offset,G.offset),M=L<b.length?b.charAt(L):null,N=E.offset>G.offset?E:G;throw new this.SyntaxError(C(H),M,L,N.line,N.column)}return K},toSource:function(){return this._source}};return b.SyntaxError=function(b,c,d,e,f){function g(b,c){var d,e;switch(b.length){case 0:d="end of input";break;case 1:d=b[0];break;default:d=b.slice(0,b.length-1).join(", ")+" or "+b[b.length-1]}return e=c?a(c):"end of input","Expected "+d+" but "+e+" found."}this.name="SyntaxError",this.expected=b,this.found=c,this.message=g(b,c),this.offset=d,this.line=e,this.column=f},b.SyntaxError.prototype=Error.prototype,b}();var Excellent=Excellent||{};Excellent.Util=function(){var a={};return a.xmlToJson=function(b){var c,d,e,f,g={};if(1===b.nodeType&&b.attributes.length>0)for(g["@"]={},c=0;c<b.attributes.length;c+=1)e=b.attributes.item(c),g["@"][e.nodeName]=e.nodeValue;else 3===b.nodeType&&(g=b.nodeValue);if(b.hasChildNodes())for(c=0;c<b.childNodes.length;c+=1)f=b.childNodes.item(c),void 0===g[f.nodeName]?g[f.nodeName]=a.xmlToJson(f):(void 0===g[f.nodeName].push&&(d=g[f.nodeName],g[f.nodeName]=[],g[f.nodeName].push(d)),g[f.nodeName].push(a.xmlToJson(f)));return g},a.fromBase26=function(a){a=a.toUpperCase();var b,c=0,d=0;if(null!==a&&void 0!==a&&a.length>0)for(b=0;b<a.length;b+=1)c=a.charCodeAt(a.length-b-1)-"A".charCodeAt(0),d+=Math.pow(26,b)*(c+1);return d-1},a.toBase26=function(a){a=Math.abs(a);var b,c="",d=!1;do b=a%26,d&&25>a&&(b-=1),c=String.fromCharCode(b+"A".charCodeAt(0))+c,a=Math.floor((a-b)/26),d=!0;while(a>0);return c},a.isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},a.getRowFromCell=function(a){return parseInt(a.match(/[0-9]+/gi)[0],10)-1},a.getColFromCell=function(a){return a=a.match(/[A-Z]+/gi)[0],Excellent.Util.fromBase26(a)},a.each=function(a,b,c){if(null!==a&&void 0!==a){var d,e={};if(a.forEach===Array.prototype.forEach)a.forEach(b,c);else for(d in a)if(a.hasOwnProperty(d)&&b.call(c,a[d],d,a)===e)return}},a}(),"undefined"!=typeof exports&&(exports.Excellent=Excellent);var Excellent=Excellent||{};if("undefined"!=typeof exports)var Excellent=require("./excellent.util.js").Excellent,Formula=require("formulajs");var Formula=Formula||{};Formula.VLOOKUP=function(a,b,c){var d,e;for(b=b||0,c=c||!1,d=0;d<this.length;d+=1)if(e=this[d],c&&e[0]===a||-1!==e[0].toLowerCase().indexOf(a.toLowerCase()))return b<e.length?e[b]:e;return null},Formula.MATCH=function(a,b,c){var d,e;for(c=c||!1,d=0;d<b.length;d+=1)if(e=b[d],c&&e===a||String(e).toLowerCase()===String(a).toLowerCase())return e;return null},Formula.INDEX=function(a,b){return a[b]},Excellent.Workbook=function(){var self={};return self.workbook={},self.currentSheet={},self.type="",self.fileVersion="",self.addSheet=function(a){return self.workbook.hasOwnProperty(a)||(self.workbook[a]={}),self.currentSheet=self.workbook[a],self.currentSheet.variables=[],self.currentSheet.functions=[],self.currentSheet.rows=[],this},self.setType=function(a){return self.type=a,this},self.setFileVersion=function(a){return self.fileVersion=a,this},self.addCellVal=function(a,b){var c,d,e,f;return self.currentSheet["_"+a]=b,self.currentSheet.variables.push(a),c=self.currentSheet,c[a]?void 0:(Object.defineProperty(c,a,{get:function(){return c["_"+a]},set:function(b){c["_"+a]=b}}),d=Excellent.Util.getRowFromCell(a),e=Excellent.Util.getColFromCell(a),void 0===self.currentSheet.rows[d]&&(self.currentSheet.rows[d]=[]),self.currentSheet.rows[d][e]={index:a},f=c["_"+a],self.currentSheet.rows[d][e]={index:a,value:f},this)},self.addCellFunc=function(cellName,cellVal){var sheet,row,col,func;return self.currentSheet["_"+cellName]=cellVal,self.currentSheet.functions.push(cellName),sheet=self.currentSheet,sheet[cellName]?void 0:(Object.defineProperty(sheet,cellName,{get:function(){return eval(sheet["_"+cellName])},set:function(a){sheet["_"+cellName]=a}}),row=Excellent.Util.getRowFromCell(cellName),col=Excellent.Util.getColFromCell(cellName),void 0===self.currentSheet.rows[row]&&(self.currentSheet.rows[row]=[]),func=sheet["_"+cellName],self.currentSheet.rows[row][col]={index:cellName,value:func},this)},self.getRawWorkbook=function(){return self.workbook},self.zeroOutNullRows=function(){var a,b;for(a in self.workbook)self.workbook.hasOwnProperty(a)&&self.workbook[a].rows.forEach(function(b,c){b.forEach(function(b,d){null===b&&(self.workbook[a].rows[c][d]=0)})});for(a in self.workbook)if(self.workbook.hasOwnProperty(a))for(b in self.workbook[a])self.workbook[a].hasOwnProperty(b)&&null===self.workbook[a][b]&&(self.workbook[a][b]=0)},self},"undefined"!=typeof exports&&(exports.Excellent=Excellent);var Excellent=Excellent||{};if("undefined"!=typeof exports)var Excellent=require("./excellent.workbook.js").Excellent;Excellent.Loader=function(){var a={};return a.load=function(a){function b(a){return null!==a&&void 0!==a&&!Excellent.Util.isNumber(a)&&0===a.lastIndexOf("[function]",0)}function c(a){var c=a;return b(a)&&(c=a.replace("[function]","")),c}function d(a,d){var e,f,g;if(null!==a&&void 0!==a)for(g=0;g<a.length;g+=1)e=String(Excellent.Util.toBase26(g)+(d+1)),f=c(a[g]),b(a[g])?h.addCellFunc(e,f):h.addCellVal(e,f)}function e(a){var b;for(b=0;b<a.length;b+=1)d(a[b],b)}function f(){var b;for(b in a)a.hasOwnProperty(b)&&(h=g.addSheet(b),e(a[b]))}var g=new Excellent.Workbook,h={};return f(),g},a.unload=function(a){function b(){var a,b,e,f,g,h;for(a in d)if(d.hasOwnProperty(a)){for(c[a]=[],b=d[a],h=0;h<b.variables.length;h+=1)e=b.variables[h],f=Excellent.Util.getRowFromCell(e),g=Excellent.Util.getColFromCell(e),void 0===c[a][f]&&(c[a][f]=[]),c[a][f][g]=b["_"+e];for(h=0;h<b.functions.length;h+=1)e=b.functions[h],f=Excellent.Util.getRowFromCell(e),g=Excellent.Util.getColFromCell(e),void 0===c[a][f]&&(c[a][f]=[]),c[a][f][g]="[function]"+b["_"+e]}for(a in c)if(c.hasOwnProperty(a))for(h=0;h<c[a].length;h+=1)void 0===c[a][h]&&(c[a][h]=[])}var c={},d=a.workbook;return b(),c},a},"undefined"!=typeof exports&&(exports.Excellent=Excellent);var Excellent=Excellent||{};if("undefined"!=typeof exports)var Excellent=require("./excellent.workbook.js").Excellent,JSZip=require("jszip"),FormulaParser=require("./excellent.parser.js");if("undefined"==typeof DOMParser)var DOMParser=require("xmldom").DOMParser;Array.prototype.contains=function(a){var b;for(b=0;b<this.length;b+=1)if(this[b]===a)return!0;return!1},Array.prototype.unique=function(){var a,b=[];for(a=0;a<this.length;a+=1)b.contains(this[a])||b.push(this[a]);return b},Excellent.Xlsx=function(){function a(a){function b(a,b){return a.indexOf(b)>-1}function c(a){var b="";return a=a.trim(),a&&"+"===a.substring(0,1)&&(a=a.substring(1)),b=FormulaParser.parse(a),b=b.trim()}function f(a){var e,f,g,h,i;if(e=a.f["@"],i=a.f["#text"],void 0!==e&&void 0!==i&&"shared"===e.t&&(f=e.ref,g=e.si,void 0!==f&&void 0!==g)){2!==f.split(":").length&&(f=f+":"+f),h=i.match(/[A-Z]+[1-9][0-9]*/g).unique();var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=f.split(":"),z=y[0],A=y[1],B=parseInt(z.match(/[0-9]+/gi)[0],10),C=z.match(/[A-Z]+/gi)[0],D=Excellent.Util.fromBase26(C),E=parseInt(A.match(/[0-9]+/gi)[0],10),F=A.match(/[A-Z]+/gi)[0],G=E-B+1,H=Excellent.Util.fromBase26(F)-Excellent.Util.fromBase26(C)+1,I="",J="",K={};for(k=1;G>=k;k+=1){for(l=0;H>l;l+=1)for(I=String(Excellent.Util.toBase26(D+l)+(B+k-1)),j=0;j<h.length;j+=1)m=h[j],n=parseInt(m.match(/[0-9]+/gi)[0],10),o=m.match(/[A-Z]+/gi)[0],p=Excellent.Util.fromBase26(o),q=Excellent.Util.toBase26(p+l),r=n+k-1,J=String(q+r),s=String("$"+q+r),t=String("$"+o+r),u=q+"$"+r,v=q+"$"+n,w=String("$"+o+n),x=o+"$"+n,void 0===K[I]&&(K[I]=i),b(K[I],w)||b(K[I],x)||(b(K[I],s)?J=t:b(K[I],u)&&(J=v),K[I]=K[I].replace(m,J));l=0}return Excellent.Util.each(K,function(a,b){d.addCellFunc(b,c(a.replace(/\$/g,"")))}),K}}function g(a){var b,g,h;void 0!==a&&(b=a["@"],void 0!==b&&(g=b.r,h=b.t,void 0!==a.f&&void 0!==a.f["@"]&&"shared"===a.f["@"].t?f(a):"s"===h?d.addCellVal(g,e.get(parseInt(a.v["#text"],10))):void 0!==a.f&&void 0!==a.f["#text"]?d.addCellFunc(g,c(a.f["#text"].replace(/\$/g,""))):void 0!==a.v&&(Excellent.Util.isNumber(a.v["#text"])?d.addCellVal(g,parseFloat(a.v["#text"])):d.addCellVal(g,a.v["#text"]))))}function h(a){Excellent.Util.each(a,function(a){g(a)})}var i,j,k,l={};return j=(new DOMParser).parseFromString(a,"text/xml"),k=Excellent.Util.xmlToJson(j),i=k.worksheet.sheetData,l.load=function(){Excellent.Util.each(i,function(a){Excellent.Util.each(a,function(a){h(void 0===a.c||void 0===a.c.length?[a.c]:a.c)})})},l}function b(b,c){function e(){var a,b;a=j.fileVersion["@"],b=a.lastEdited+"."+a.lowestEdited+"."+a.rupBuild,d.setType(a.appName).setFileVersion(b)}function f(b){var c,d,e;c=b["r:id"].replace("rId",""),d="xl/worksheets/sheet"+c+".xml",e=new a(i.file(d).asText()),e.load()}function g(){var a=j.sheets.sheet;Excellent.Util.each(a,function(a){void 0!==a&&(void 0!==a["@"]&&(a=a["@"]),d.addSheet(a.name),f(a))})}var h,i,j,k={};return h=(new DOMParser).parseFromString(b,"text/xml"),i=c,j=Excellent.Util.xmlToJson(h).workbook,k.load=function(){e(),g()},k}var c={},d=new Excellent.Workbook,e=function(){function a(a){var b="";return b=void 0!==a.t?a.t["#text"]:""}function b(b){var c,e,f,g;c=(new DOMParser).parseFromString(b,"text/xml"),e=Excellent.Util.xmlToJson(c),f=[],g=e.sst.si,Excellent.Util.each(g,function(b){f.push(a(b))}),d=f}function c(a){return d[a]}var d=[];return{set:function(a){b(a)},get:function(a){return c(a)}}}();return c.load=function(a){function c(a){var c,f,g;return c=new JSZip(a),f=c.file("xl/sharedStrings.xml"),null!==f&&e.set(f.asText()),g=new b(c.file("xl/workbook.xml").asText(),c),g.load(),d}return c(a)},c},"undefined"!=typeof exports&&(exports.Excellent=Excellent);var Excellent=Excellent||{};if("undefined"!=typeof exports)var Excellent=require("./excellent.workbook.js").Excellent,JSZip=require("jszip");if("undefined"==typeof DOMParser)var DOMParser=require("xmldom").DOMParser;Array.prototype.contains=function(a){var b;for(b=0;b<this.length;b+=1)if(this[b]===a)return!0;return!1},Array.prototype.unique=function(){var a,b=[];for(a=0;a<this.length;a+=1)b.contains(this[a])||b.push(this[a]);return b},Excellent.XlsxSimple=function(){function a(a){function b(a){var b,c,f;void 0!==a&&(b=a["@"],void 0!==b&&(c=b.r,f=b.t,"s"===f?d.addCellVal(c,e.get(parseInt(a.v["#text"],10))):void 0!==a.v&&(Excellent.Util.isNumber(a.v["#text"])?d.addCellVal(c,parseFloat(a.v["#text"])):d.addCellVal(c,a.v["#text"]))))}function c(a){Excellent.Util.each(a,function(a){b(a)})}var f,g,h,i={};return g=(new DOMParser).parseFromString(a,"text/xml"),h=Excellent.Util.xmlToJson(g),f=h.worksheet.sheetData,i.load=function(){Excellent.Util.each(f,function(a){Excellent.Util.each(a,function(a){c(void 0===a.c||void 0===a.c.length?[a.c]:a.c)})})},i}function b(b,c){function e(){var a,b;a=j.fileVersion["@"],b=a.lastEdited+"."+a.lowestEdited+"."+a.rupBuild,d.setType(a.appName).setFileVersion(b)}function f(b){var c,d,e;c=b["r:id"].replace("rId",""),d="xl/worksheets/sheet"+c+".xml",e=new a(i.file(d).asText()),e.load()}function g(){var a=j.sheets.sheet;Excellent.Util.each(a,function(a){void 0!==a&&(void 0!==a["@"]&&(a=a["@"]),d.addSheet(a.name),f(a))})}var h,i,j,k={};return h=(new DOMParser).parseFromString(b,"text/xml"),i=c,j=Excellent.Util.xmlToJson(h).workbook,k.load=function(){e(),g()},k}var c={},d=new Excellent.Workbook,e=function(){function a(a){var b="";return void 0!==a.t&&(b=a.t["#text"]),b}function b(b){var c,e,f,g;c=(new DOMParser).parseFromString(b,"text/xml"),e=Excellent.Util.xmlToJson(c),f=[],g=e.sst.si,Excellent.Util.each(g,function(b){f.push(a(b))}),d=f}function c(a){return d[a]}var d=[];return{set:function(a){b(a)},get:function(a){return c(a)}}}();return c.load=function(a){function c(a){var c,f,g;return c=new JSZip(a),f=c.file("xl/sharedStrings.xml"),null!==f&&e.set(f.asText()),g=new b(c.file("xl/workbook.xml").asText(),c),g.load(),d}return c(a)},c},"undefined"!=typeof exports&&(exports.Excellent=Excellent)}();